---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# nycdogs  <img src="man/figures/nycdogs.png" align="right" width="360">

<!-- badges: start -->
[![R-CMD-check](https://github.com/kjhealy/nycdogs/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/kjhealy/nycdogs/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

## Installation

`nycdogs` is a data package. Install the package from [GitHub](https://github.com/kjhealy/nycdogs) with:

``` r
# install.packages("pak")
pak::pak("kjhealy/nycdogs")
```

The `nycdogs` package contains two datasets, `nyc_license` and `nyc_bites`. They contain, respectively, data on all licensed dogs in New York city (current), and data on reported dog bites in New York city (older data). It also re-exports objects from [`nyczips`](https://kjhealy.github.com/nyczips) to make it easier to draw maps of the data.


## Loading the data

The package works best with the [tidyverse](http://tidyverse.org/) libraries and the [simple features](https://r-spatial.github.io/sf/index.html) package for mapping.

```{r libs}
library(tidyverse)
library(sf) 
```

Load the data:

```{r load}
library(nycdogs)
```

To look at the tibble that contains the licensing data, do this:

```{r load-doc}
nyc_license
```

## Example

Where dogs with a particular name live:

```{r mapexample-1}
#| fig.caption = "Distribution of Dogs Named Coco", 
#| dpi = 300, 
#| fig.width = 8,
#| fig.height = 8


boro_names <- c("Manhattan", "Queens", "Brooklyn", 
                "Bronx", "Staten Island")

nyc_coco <- nyc_license |>
  filter(borough %in% boro_names) |> 
  group_by(zip, animal_name) |> 
  tally() |>
  ungroup() |>
  complete(zip, animal_name, 
           fill = list(n = 0)) |> 
  filter(animal_name == "Coco") |> 
  mutate(freq = n / sum(n),
           pct = round(freq*100, 2)) 


nyc_coco

## nyc_zip_sf is from the nyczips package, which is automatically loaded by nycdogs.
coco_map <- left_join(nyc_zip_sf, nyc_coco)

## Map theme
theme_nymap <- function(base_size=9, base_family="") {
    require(grid)
    theme_bw(base_size=base_size, base_family=base_family) %+replace%
        theme(axis.line=element_blank(),
              axis.text=element_blank(),
              axis.ticks=element_blank(),
              axis.title=element_blank(),
              panel.background=element_blank(),
              panel.border=element_blank(),
              panel.grid=element_blank(),
              panel.spacing=unit(0, "lines"),
              plot.background=element_blank(),
              legend.justification = c(0,0),
              legend.position = "inside",
              legend.position.inside = c(0, 0.7), 
              legend.direction = "horizontal"
        )
}

coco_map |> ggplot(mapping = aes(fill = pct)) +
    geom_sf(color = "gray80", linewidth = 0.1) +
    scale_fill_binned(guide = "bins", type = "viridis", option = "A") +
    labs(fill = "Percent of all NYC\ndogs named Coco") +
  annotate(geom = "text", x = -74.16, y = 40.84, 
           label = "Where's Coco?", size = 6) + 
    theme_nymap() 
  

```
